(function(b,d,f,e,a,g,l){b(document).ready(function(){function n(){b(".tribe-events-day-time-slot").length&&(b(".tribe-events-day-time-slot").find(".vevent:last").addClass("tribe-events-last"),b(".tribe-events-day-time-slot:first").find(".vevent:first").removeClass("tribe-events-first"))}function p(c){"change_view"!=tribe_events_bar_action&&(c.preventDefault(),a.ajax_running||(c=b("#tribe-bar-date").val(),a.popping=!1,c.length?(a.date=b("#tribe-bar-date").val(),d.cur_url=h+a.date+"/"):(a.date=d.cur_date,
d.cur_url=h+d.cur_date+"/"),e.pre_ajax(function(){k()})))}function k(){a.pushcount=0;a.ajax_running=!0;if(!a.popping&&(a.url_params="",a.params={action:"tribe_event_day",eventDate:a.date},a.url_params={action:"tribe_event_day"},a.category&&(a.params.tribe_event_category=a.category),b(f).trigger("tribe_ev_serializeBar"),a.params=b.param(a.params),a.url_params=b.param(a.url_params),b(f).trigger("tribe_ev_collectParams"),a.pushstate=!0,a.do_string=!1,0<a.pushcount||a.filters))a.pushstate=!1,a.do_string=
!0;g.pushstate&&!a.filter_cats?(l&&debug.time("Day View Ajax Timer"),b(f).trigger("tribe_ev_ajaxStart").trigger("tribe_ev_dayView_AjaxStart"),b("#tribe-events-header").tribe_spin(),b.post(TribeCalendar.ajaxurl,a.params,function(c){a.initial_load=!1;e.enable_inputs("#tribe_events_filters_form","input, select");c.success&&(a.ajax_running=!1,d.ajax_response={total_count:parseInt(c.total_count),view:c.view,max_pages:"",tribe_paged:"",timestamp:(new Date).getTime()},b("#tribe-events-content").replaceWith(c.html),
0===c.total_count&&b("#tribe-events-header .tribe-events-sub-nav").empty(),b(".tribe-events-promo").next(".tribe-events-promo").remove(),c=b("#tribe-events-header").attr("data-title"),b(document).attr("title",c),a.do_string&&(d.cur_url=d.cur_url+"?"+a.url_params,history.pushState({tribe_date:a.date,tribe_params:a.params},c,d.cur_url)),a.pushstate&&history.pushState({tribe_date:a.date,tribe_params:a.params},c,d.cur_url),n(),b(f).trigger("tribe_ev_ajaxSuccess").trigger("tribe_ev_dayView_AjaxSuccess"),
l&&debug.timeEnd("Day View Ajax Timer"))})):window.location=a.do_string?d.cur_url+"?"+a.url_params:d.cur_url}var h=a.filter_cats?b("#tribe-events-header").attr("data-baseurl").slice(0,-11):b("#tribe-events-footer .tribe-events-nav-next a").attr("href").slice(0,-11);a.date=b("#tribe-events-header").attr("data-date");n();if(g.pushstate&&!g.map_view()){var m="action=tribe_event_day&eventDate="+a.date;d.params.length&&(m=m+"&"+d.params);history.replaceState({tribe_params:m,tribe_url_params:d.params},
"",location.href);b(window).on("popstate",function(b){if(b=b.originalEvent.state)a.do_string=!1,a.pushstate=!1,a.popping=!0,a.params=b.tribe_params,e.pre_ajax(function(){k()}),e.set_form(a.params)})}b("#tribe-events").on("click",".tribe-events-nav-previous a, .tribe-events-nav-next a",function(c){c.preventDefault();a.ajax_running||(c=b(this),a.popping=!1,a.date=c.attr("data-day"),d.cur_url=a.filter_cats?h+a.date+"/":c.attr("href"),e.update_picker(a.date),e.pre_ajax(function(){k()}))});e.snap("#tribe-events-bar",
"#tribe-events","#tribe-events-footer .tribe-events-nav-previous a, #tribe-events-footer .tribe-events-nav-next a");b("form#tribe-bar-form").on("submit",function(a){p(a)});if(g.live_ajax()&&g.pushstate)b("#tribe-bar-date").on("changeDate",function(c){g.reset_on()||(a.popping=!1,a.date=b(this).val(),d.cur_url=h+a.date+"/",e.pre_ajax(function(){k()}))});b(f).on("tribe_ev_runAjax",function(){k()});b(f).on("tribe_ev_updatingRecurrence",function(){d.cur_url=a.filter_cats?h+a.date+"/":b("#tribe-events-header").attr("data-baseurl");
a.popping=!1});l&&debug.info("tribe-events-ajax-day.js successfully loaded");a.view&&l&&debug.timeEnd("Tribe JS Init Timer")})})(jQuery,tribe_ev.data,tribe_ev.events,tribe_ev.fn,tribe_ev.state,tribe_ev.tests,tribe_debug);
