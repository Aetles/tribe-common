var calendar_filters;function calendar_toggle(a){jQuery(".calendar-widget-filters-title").hide();jQuery(".calendar-widget-filters-operand").hide();a||(a=jQuery(".calendar-widget-add-filter").last().parents(".widget-content"));0===a.find(".calendar-widget-filter-list li").length&&(calendar_filters={});var b=get_term_count();0<b&&(a.find(".calendar-widget-filters-title").show(),1<b&&a.find(".calendar-widget-filters-operand").show())}
function get_term_count(){var a=0,b;for(b in calendar_filters)a+=calendar_filters[b].length;return a}
jQuery(document).ready(function(a){calendar_filters||(calendar_filters={});calendar_toggle();a("div.widgets-sortables").on("sortstop",function(){a("div.widgets-sortables").find(".calendar-widget-add-filter").length&&(a(".select2-container.calendar-widget-add-filter").remove(),setTimeout(function(){a(".calendar-widget-add-filter").select2();calendar_toggle()},600))});a(".calendar-widget-add-filter").select2();a("body").on("change",".calendar-widget-add-filter",function(b){a(".calendar-widget-filters-container").show();
var c=a(this);b=a(this.options[this.selectedIndex]);var c=c.parents(".widget-content"),e=c.find(".calendar-widget-filter-list"),d=c.find(".calendar-widget-added-filters"),f=b.attr("value"),h=b.closest("optgroup"),g=h.attr("id"),h=h.attr("label");0!==parseInt(f)&&(calendar_filters[g]||(calendar_filters[g]=[]),-1==jQuery.inArray(f,calendar_filters[g])&&(calendar_filters[g].push(f),d.val(JSON.stringify(calendar_filters)),d=a("<a/>").addClass("calendar-widget-remove-filter").attr("data-tax",g).attr("data-term",
f).text("(remove)").attr("href","#"),d=a("<span/>").append(d),b=a("<li/>").append("p").text(h+": "+b.text()+"   ").append(d),e.append(b),calendar_toggle(c)))});a("body").on("click",".calendar-widget-remove-filter",function(b){b.preventDefault();b=a(this);var c=b.attr("data-tax"),e=b.attr("data-term"),d=b.parents(".widget-content"),f=d.find(".calendar-widget-added-filters");calendar_filters[c]&&calendar_filters[c].myremove(e);f.val(JSON.stringify(calendar_filters));b.parents("li").remove();calendar_toggle(d)});
Array.prototype.myremove=function(){for(var a,c=arguments,e=c.length,d;e&&this.length;)for(a=c[--e];-1!=(d=this.indexOf(a));)this.splice(d,1);return this};Array.prototype.indexOf||(Array.prototype.indexOf=function(a,c){c=c||0;for(var e=this.length;c<e;){if(this[c]===a)return c;++c}return-1})});
