(function(a){a.extend(tribe_ev.fn,{has_address:function(a,c){for(var e=0;e<c.length;e++)if(c[e].formatted_address==a)return!0;return!1},pre_ajax:function(b){if(a("#tribe-bar-geoloc").length){var c=a("#tribe-bar-geoloc").val();c.length?tribe_ev.fn.process_geocoding(c,function(e){tribe_ev.geoloc.geocodes=e;if(1<tribe_ev.geoloc.geocodes.length&&!tribe_ev.fn.has_address(c,tribe_ev.geoloc.geocodes))tribe_ev.fn.print_geo_options();else{var d=e[0].geometry.location.lat();e=e[0].geometry.location.lng();d&&
a("#tribe-bar-geoloc-lat").val(d);e&&a("#tribe-bar-geoloc-lng").val(e);b&&"function"===typeof b&&(a("#tribe_events_filter_item_geofence").length&&a("#tribe_events_filter_item_geofence").show(),b())}}):(a("#tribe-bar-geoloc-lat, #tribe-bar-geoloc-lng").val(""),b&&"function"===typeof b&&(a("#tribe_events_filter_item_geofence").length&&(a("#tribe_events_filter_item_geofence input").prop("checked",!1),a("#tribe_events_filter_item_geofence").hide().find("select").prop("selectedIndex",0)),b()))}else b&&
"function"===typeof b&&b()},pro_tooltips:function(){a("#tribe-events").on("mouseenter",'div[id*="tribe-events-event-"], div[id*="tribe-events-daynum-"]:has(a), div.event-is-recurring',function(){var b=0,c=a(this);if(a("body").hasClass("tribe-events-week")){var e=c.find(".tribe-events-tooltip");if(c.parents(".tribe-grid-allday").length)b=c.outerHeight()+6,e.css("bottom",b).show();else{var d=a(".tribe-week-grid-wrapper"),f=c.parent(),b=f.parent(),g=Math.ceil(b.width()),h=Math.ceil(c.width()),k=Math.ceil(e.outerWidth()),
b=d.height(),l=d.scrollTop(),d=f.position(),c=c.position(),c=Math.ceil(c.top),c=l-c,f=f.hasClass("tribe-events-right"),l={};e.hasClass("hovered")||e.attr("data-ow",k).addClass("hovered");g=f?Math.ceil(d.left)-20:g-h-Math.ceil(d.left);k=k>=g?g:e.attr("data-ow")>g?g:e.attr("data-ow");l=f?{right:h+20,bottom:"auto",width:k+"px"}:{left:h+20,bottom:"auto",width:k+"px"};e.css(l);h=e.height();0<=c?c+=5:(b=c+b,c=h>b?b-h-8:5);e.css("top",c).show()}}})},print_geo_options:function(){a("#tribe-geo-links").empty();
a("#tribe-geo-options").show();for(var b=0;b<tribe_ev.geoloc.geocodes.length;b++)a("<a/>").text(tribe_ev.geoloc.geocodes[b].formatted_address).attr("href","#").addClass("tribe-geo-option-link").attr("data-index",b).appendTo("#tribe-geo-links"),tribe_ev.tests.map_view()&&tribe_ev.fn.map_add_marker(tribe_ev.geoloc.geocodes[b].geometry.location.lat(),tribe_ev.geoloc.geocodes[b].geometry.location.lng(),tribe_ev.geoloc.geocodes[b].formatted_address)},process_geocoding:function(a,c){tribe_ev.geoloc.geocoder.geocode({address:a},
function(a,b){if(b==google.maps.GeocoderStatus.OK)return c(a),a;b==google.maps.GeocoderStatus.ZERO_RESULTS&&GeoLoc.map_view&&spin_end();return b})},set_recurrence:function(a){a?(tribe_ev.state.recurrence=!0,tribe_storage&&tribe_storage.setItem("tribeHideRecurrence","1")):(tribe_ev.state.recurrence=!1,tribe_storage&&tribe_storage.setItem("tribeHideRecurrence","0"))}});a.extend(tribe_ev.tests,{hide_recurrence:function(){return a("#tribeHideRecurrence:checked").length?!0:!1},map_view:function(){return"undefined"!==
typeof GeoLoc&&GeoLoc.map_view?!0:!1}});tribe_ev.geoloc={map:[],geocoder:[],geocodes:[],bounds:[],markers:[]}})(jQuery);
(function(a,b,c,e,d,f){a(document).ready(function(){function g(){var b=document.URL,c="?";0<b.indexOf("?")&&(c="&");b=b+c+"ical=1&tribe_display="+d.view;a("a.tribe-events-ical").attr("href",b)}a(".tribe-bar-geoloc-filter").length&&a(".tribe-bar-geoloc-filter").append('<div id="tribe-geo-options"><div id="tribe-geo-links"></div></div>');var h=a("#tribe-events"),k=a("#tribe-bar-geoloc"),l=a("#tribe-geo-options"),m=!1;c.pro_tooltips();f.hide_recurrence()&&c.set_recurrence(!0);a(b).on("tribe_ev_ajaxSuccess",
function(){g()});g();d.recurrence=f.hide_recurrence();h.on("click","#tribeHideRecurrence",function(){d.popping=!1;d.do_string=!0;d.paged=1;m=a(this).is(":checked")?!0:!1;c.set_recurrence(m);a(b).trigger("tribe_ev_updatingRecurrence").trigger("tribe_ev_runAjax")});a(b).on("tribe_ev_preCollectBarParams",function(){k.length&&(k.val().length?"map"===d.view_target&&(d.url_params.action="tribe_geosearch"):a("#tribe-bar-geoloc-lat, #tribe-bar-geoloc-lng").val(""));tribe_storage&&"1"===tribe_storage.getItem("tribeHideRecurrence")&&
("month"!==d.view_target&&"week"!==d.view_target)&&(d.url_params.tribeHideRecurrence="1")});f.map_view()||(l.length&&(h.on("click",".tribe-geo-option-link",function(d){d.preventDefault();d.stopPropagation();d=a(this);a(".tribe-geo-option-link").removeClass("tribe-option-loaded");d.addClass("tribe-option-loaded");k.val(d.text());a("#tribe-bar-geoloc-lat").val(e.geocodes[d.attr("data-index")].geometry.location.lat());a("#tribe-bar-geoloc-lng").val(e.geocodes[d.attr("data-index")].geometry.location.lng());
c.pre_ajax(function(){a(b).trigger("tribe_ev_runAjax");l.hide()})}),a("body").on("click",function(a){l.hide()})),c.snap("#tribe-geo-wrapper","#tribe-geo-wrapper","#tribe-events-footer .tribe-events-nav-previous a, #tribe-events-footer .tribe-events-nav-next a"))})})(jQuery,tribe_ev.events,tribe_ev.fn,tribe_ev.geoloc,tribe_ev.state,tribe_ev.tests);
