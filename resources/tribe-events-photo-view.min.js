(function(b,c,g,f,a,h,l){b(document).ready(function(){function q(){b(".photo-loader").hide();b("#tribe-events-photo-events").removeClass("photo-hidden").animate({opacity:"1"},{duration:600})}function m(a){if(b().isotope){var n=!1,e=0,c=0;a.imagesLoaded(function(){a.isotope({transformsEnabled:!1,containerStyle:{position:"relative",overflow:"visible"}},q())});a.resize(function(){c=a.width();645>c?a.addClass("photo-two-col"):a.removeClass("photo-two-col");n&&c!==e&&a.isotope("reLayout");n=!0;e=c})}else b("#tribe-events-photo-events").removeClass("photo-hidden").css("opacity",
"1")}function p(b){"change_view"!=tribe_events_bar_action&&(b.preventDefault(),a.ajax_running||(a.paged=1,a.popping=!1,f.pre_ajax(function(){k()})))}function k(){b("#tribe-events-content").tribe_spin();b(".photo-loader").show();b("#tribe-events-photo-events").addClass("photo-hidden");if(!a.popping){a.ajax_running=!0;a.filter_cats&&(c.cur_url=b("#tribe-events-header").attr("data-baseurl"));var d=b("#tribe-events-list-hash").val();a.params={action:"tribe_photo",tribe_paged:a.paged,tribe_event_display:a.view};
a.url_params={action:"tribe_photo",tribe_paged:a.paged,tribe_event_display:a.view};d.length&&(a.params.hash=d);a.category&&(a.params.tribe_event_category=a.category);b(g).trigger("tribe_ev_serializeBar");a.params=b.param(a.params);a.url_params=b.param(a.url_params);b(g).trigger("tribe_ev_collectParams");a.pushstate=!1;a.do_string=!0}h.pushstate&&!a.filter_cats?(l&&debug.time("Photo View Ajax Timer"),b(g).trigger("tribe_ev_ajaxStart").trigger("tribe_ev_photoView_AjaxStart"),b.post(TribePhoto.ajaxurl,
a.params,function(d){a.initial_load=!1;f.enable_inputs("#tribe_events_filters_form","input, select");d.success&&(a.ajax_running=!1,c.ajax_response={total_count:parseInt(d.total_count),view:d.view,max_pages:d.max_pages,tribe_paged:d.tribe_paged,timestamp:(new Date).getTime()},b("#tribe-events-list-hash").val(d.hash),b("#tribe-events-content").replaceWith(d.html),b("#tribe-events-content").prev("#tribe-events-list-hash").remove(),b(".tribe-events-promo").next(".tribe-events-promo").remove(),"photo"===
d.view?d.max_pages==a.paged?b(".tribe-events-nav-next").hide():b(".tribe-events-nav-next").show():d.max_pages==a.paged?b(".tribe-events-nav-previous").hide():b(".tribe-events-nav-previous").show(),a.do_string&&history.pushState({tribe_params:a.params,tribe_url_params:a.url_params},"",c.cur_url+"?"+a.url_params),a.pushstate&&history.pushState({tribe_params:a.params,tribe_url_params:a.url_params},"",c.cur_url),m(b("#tribe-events-photo-events")),b(g).trigger("tribe_ev_ajaxSuccess").trigger("tribe_ev_photoView_AjaxSuccess"),
l&&debug.timeEnd("Photo View Ajax Timer"))})):window.location=a.do_string?c.cur_url+"?"+a.url_params:c.cur_url}var e=f.get_url_param("tribe_paged");a.view="photo";e&&(a.paged=e);e=b("#tribe-events-photo-events");m(e);643>e.width()&&e.addClass("photo-two-col");h.pushstate&&!h.map_view()&&(e="action=tribe_photo&tribe_paged="+a.paged,c.params.length&&(e=e+"&"+c.params),history.replaceState({tribe_params:e,tribe_url_params:c.params},"",location.href),b(window).on("popstate",function(b){if(b=b.originalEvent.state)a.do_string=
!1,a.pushstate=!1,a.popping=!0,a.params=b.tribe_params,a.url_params=b.tribe_url_params,f.pre_ajax(function(){k()}),f.set_form(a.params)}));b("#tribe-events").on("click","li.tribe-events-nav-next a",function(b){b.preventDefault();a.ajax_running||("past"===a.view?1===a.paged?a.view="photo":a.paged--:a.paged++,a.popping=!1,f.pre_ajax(function(){k()}))}).on("click","li.tribe-events-nav-previous a",function(b){b.preventDefault();a.ajax_running||("photo"===a.view?1===a.paged?a.view="past":a.paged--:a.paged++,
a.popping=!1,f.pre_ajax(function(){k()}))});if(h.live_ajax()&&h.pushstate)b("#tribe-bar-date").on("changeDate",function(a){h.reset_on()||p(a)});b(g).on("tribe_ev_updatingRecurrence",function(){a.popping=!1});b("#tribe-bar-form").on("submit",function(a){"change_view"!=tribe_events_bar_action&&p(a)});f.snap("#tribe-events-content","#tribe-events-content","#tribe-events-footer .tribe-events-nav-previous a, #tribe-events-footer .tribe-events-nav-next a");b(g).on("tribe_ev_runAjax",function(){k()});l&&
debug.info("tribe-events-photo-view.js successfully loaded");a.view&&l&&debug.timeEnd("Tribe JS Init Timer")})})(jQuery,tribe_ev.data,tribe_ev.events,tribe_ev.fn,tribe_ev.state,tribe_ev.tests,tribe_debug);
