(function(b,k,h,d,c,a,f,t){b.extend(tribe_ev.fn,{map_add_marker:function(a,d,g,f,h){a=new google.maps.LatLng(a,d);var k=new google.maps.Marker({position:a,map:c.map,title:g}),l=new google.maps.InfoWindow;d=g;h&&(d=b("<div/>").append(b("<a/>").attr("href",h).text(g)).html());g="Event: "+d;f&&(g=g+"<br/>Address: "+f);l.setContent(g);google.maps.event.addListener(k,"click",function(b){l.open(c.map,k)});c.markers.push(k);c.bounds.extend(a)}});c.geocoder=new google.maps.Geocoder;c.bounds=new google.maps.LatLngBounds;
b(document).ready(function(){function m(){b("#tribe-bar-geoloc").length&&(b("#tribe-bar-geoloc").val().length?b("#tribe_events_filter_item_geofence").length&&b("#tribe_events_filter_item_geofence").show():(b("#tribe_events_filter_item_geofence").length&&b("#tribe_events_filter_item_geofence").hide(),b("#tribe-bar-geoloc-lat, #tribe-bar-geoloc-lng").length&&b("#tribe-bar-geoloc-lat, #tribe-bar-geoloc-lng").val("")))}function n(){a.ajax_running=!0;a.params={action:"tribe_geosearch",tribe_paged:a.paged,
tribe_event_display:a.view};b(h).trigger("tribe_ev_serializeBar");a.params=b.param(a.params);b(h).trigger("tribe_ev_collectParams")}function g(c){b("#tribe-events-header").tribe_spin();p();a.popping||(n(),a.pushstate=!1,a.initial_load||(a.do_string=!0));b.post(GeoLoc.ajaxurl,a.params,function(c){b(h).trigger("tribe_ev_ajaxStart").trigger("tribe_ev_mapView_AjaxStart");d.enable_inputs("#tribe_events_filters_form","input, select");c.success&&(a.ajax_running=!1,k.ajax_response={total_count:parseInt(c.total_count),
view:c.view,max_pages:c.max_pages,tribe_paged:c.tribe_paged,timestamp:(new Date).getTime()},a.initial_load=!1,b("#tribe-events-content").replaceWith(c.html),"map"===c.view?c.max_pages==c.tribe_paged?b(".tribe-events-nav-next").hide():b(".tribe-events-nav-next").show():c.max_pages==c.tribe_paged?b(".tribe-events-nav-previous").hide():b(".tribe-events-nav-previous").show(),0===k.ajax_response.total_count&&b(".tribe-events-sub-nav").remove(),b.each(c.markers,function(b,a){d.map_add_marker(a.lat,a.lng,
a.title,a.address,a.link)}),f.pushstate&&(a.do_string&&history.pushState({tribe_paged:a.paged,tribe_params:a.params},"",k.cur_url+"?"+a.params),a.pushstate&&history.pushState({tribe_paged:a.paged,tribe_params:a.params},"",k.cur_url)),b(h).trigger("tribe_ev_ajaxSuccess").trigger("tribe_ev_mapView_AjaxSuccess"),0<c.markers.length&&q())})}function u(c){"change_view"!=tribe_events_bar_action&&(c.preventDefault(),a.ajax_running||(a.paged=1,a.view="map",a.popping=!1,f.pushstate?d.pre_ajax(function(){g(null)}):
d.pre_ajax(function(){b(h).trigger("tribe_ev_reloadOldBrowser")})))}function p(){if(c.markers){for(i in c.markers)c.markers[i].setMap(null);c.markers.length=0;c.bounds=new google.maps.LatLngBounds}}function q(){c.map.fitBounds(c.bounds);13<c.map.getZoom()&&c.map.setZoom(13)}function l(){b("#tribe-events-footer, #tribe-events-header").find(".tribe-events-ajax-loading").show()}function r(){b("#tribe-events-footer, #tribe-events-header").find(".tribe-events-ajax-loading").hide()}m();var e={zoom:5,center:new google.maps.LatLng(GeoLoc.center.max_lat,
GeoLoc.center.max_lng),mapTypeId:google.maps.MapTypeId.ROADMAP};document.getElementById("tribe-geo-map")&&(c.map=new google.maps.Map(document.getElementById("tribe-geo-map"),e),c.bounds=new google.maps.LatLngBounds,e=new google.maps.LatLng(GeoLoc.center.min_lat,GeoLoc.center.min_lng),c.bounds.extend(e),e=new google.maps.LatLng(GeoLoc.center.max_lat,GeoLoc.center.max_lng),c.bounds.extend(e));b("#tribe-geo-location").placeholder();if(f.map_view()){if(e=d.get_url_param("tribe_paged"))a.paged=e;b("body").addClass("events-list");
d.tooltips()}f.map_view()&&k.params?(e=k.params,0<=d.in_params(e,"tribe_geosearch")||(e+="&action=tribe_geosearch"),0<=d.in_params(e,"tribe_paged")||(e+="&tribe_paged=1"),a.params=e,a.do_string=!1,a.pushstate=!1,a.popping=!0,d.pre_ajax(function(){g(null)})):f.map_view()&&(a.do_string=!1,a.pushstate=!1,a.popping=!1,a.initial_load=!0,d.pre_ajax(function(){g(null)}));f.pushstate&&f.map_view()&&(history.replaceState({tribe_paged:a.paged,tribe_params:a.params},"",location.href),b(window).on("popstate",
function(b){if(b=b.originalEvent.state)a.do_string=!1,a.pushstate=!1,a.popping=!0,a.params=b.tribe_params,a.paged=b.tribe_paged,d.pre_ajax(function(){g(null)}),d.set_form(a.params)}));f.map_view()&&(b("#tribe-geo-options").on("click","a",function(a){l();a.preventDefault();b("#tribe-geo-options a").removeClass("tribe-option-loaded");b(this).addClass("tribe-option-loaded");b("#tribe-bar-geoloc").val(b(this).text());b("#tribe-bar-geoloc-lat").val(c.geocodes[b(this).attr("data-index")].geometry.location.lat());
b("#tribe-bar-geoloc-lng").val(c.geocodes[b(this).attr("data-index")].geometry.location.lng());f.pushstate?d.pre_ajax(function(){g(null);b("#tribe-geo-options").hide()}):d.pre_ajax(function(){b(h).trigger("tribe_ev_reloadOldBrowser")})}),d.snap("#tribe-events-content-wrapper","#tribe-events-content-wrapper","#tribe-events-footer .tribe-events-nav-previous a, #tribe-events-footer .tribe-events-nav-next a"));b(h).on("tribe_ev_reloadOldBrowser",function(){n();window.location=k.cur_url+"?"+a.params});
if(f.map_view()){var s;b("#tribe-geo-map-wrapper").resize(function(){s=c.map.getCenter();google.maps.event.trigger(c.map,"resize");c.map.setCenter(s)});b("#tribe-events").on("click","li.tribe-events-nav-next a",function(c){c.preventDefault();a.ajax_running||("past"===a.view?1===a.paged?a.view="map":a.paged--:a.paged++,a.popping=!1,f.pushstate?d.pre_ajax(function(){g(null)}):d.pre_ajax(function(){b(h).trigger("tribe_ev_reloadOldBrowser")}))}).on("click","li.tribe-events-nav-previous a",function(c){c.preventDefault();
a.ajax_running||("map"===a.view?1===a.paged?a.view="past":a.paged--:a.paged++,a.popping=!1,f.pushstate?d.pre_ajax(function(){g(null)}):d.pre_ajax(function(){b(h).trigger("tribe_ev_reloadOldBrowser")}))})}if(GeoLoc.map_view&&b("form#tribe-bar-form").length)b("#tribe-events-bar").on("changeDate","#tribe-bar-date",function(b){u(b)});if(GeoLoc.map_view)b(h).on("tribe_ev_runAjax",function(){g(null)});if(f.map_view())b("form#tribe-bar-form").on("submit",function(){if("change_view"!=tribe_events_bar_action){a.paged=
1;l();b(".tribe-events-sub-nav").remove();var e=b("#tribe-bar-geoloc").val();return""!==e?(p(),b("#tribe-geo-results").empty(),b("#tribe-geo-options").hide(),b("#tribe-geo-options #tribe-geo-links").empty(),d.process_geocoding(e,function(a){c.geocodes=a;r();var e=a[0].geometry.location.lat();a=a[0].geometry.location.lng();e&&b("#tribe-bar-geoloc-lat").val(e);a&&b("#tribe-bar-geoloc-lng").val(a);1<c.geocodes.length?(d.print_geo_options(),m(),q()):f.pushstate?(m(),g(c.geocodes[0])):b(h).trigger("tribe_ev_reloadOldBrowser")}),
!1):""===e?(b("#tribe-bar-geoloc-lat").val(""),b("#tribe-bar-geoloc-lng").val(""),b("#tribe-geo-options").hide(),f.pushstate?(m(),g(null)):b(h).trigger("tribe_ev_reloadOldBrowser"),r(),!1):!0}});t&&debug.info("tribe-events-ajax-maps.js successfully loaded")})})(jQuery,tribe_ev.data,tribe_ev.events,tribe_ev.fn,tribe_ev.geoloc,tribe_ev.state,tribe_ev.tests,tribe_debug);
