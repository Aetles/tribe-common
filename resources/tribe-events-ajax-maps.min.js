(function(p,m,a,k,h,d,c,b,f,q){a.extend(tribe_ev.fn,{map_add_marker:function(b,d,g,f,h){b=new google.maps.LatLng(b,d);var k=new google.maps.Marker({position:b,map:c.map,title:g}),l=new google.maps.InfoWindow;d=g;h&&(d=a("<div/>").append(a("<a/>").attr("href",h).text(g)).html());g="Event: "+d;f&&(g=g+"<br/>Address: "+f);l.setContent(g);google.maps.event.addListener(k,"click",function(b){l.open(c.map,k)});c.markers.push(k);c.bounds.extend(b)}});c.geocoder=new google.maps.Geocoder;c.bounds=new google.maps.LatLngBounds;
a(m).ready(function(){function n(){a("#tribe-bar-geoloc").length&&(a("#tribe-bar-geoloc").val().length?a("#tribe_events_filter_item_geofence").length&&a("#tribe_events_filter_item_geofence").show():(a("#tribe_events_filter_item_geofence").length&&a("#tribe_events_filter_item_geofence").hide(),a("#tribe-bar-geoloc-lat, #tribe-bar-geoloc-lng").length&&a("#tribe-bar-geoloc-lat, #tribe-bar-geoloc-lng").val("")))}function r(){b.ajax_running=!0;b.params={action:"tribe_geosearch",tribe_paged:b.paged,tribe_event_display:b.view};
a(h).trigger("tribe_ev_serializeBar");b.params=a.param(b.params);a(h).trigger("tribe_ev_collectParams")}function g(c){a("#tribe-events-header").tribe_spin();s();b.popping||(r(),b.pushstate=!1,b.initial_load||(b.do_string=!0));a.post(GeoLoc.ajaxurl,b.params,function(c){a(h).trigger("tribe_ev_ajaxStart").trigger("tribe_ev_mapView_AjaxStart");d.enable_inputs("#tribe_events_filters_form","input, select");c.success&&(b.ajax_running=!1,k.ajax_response={total_count:parseInt(c.total_count),view:c.view,max_pages:c.max_pages,
tribe_paged:c.tribe_paged,timestamp:(new Date).getTime()},b.initial_load=!1,a("#tribe-events-content").replaceWith(c.html),"map"===c.view?c.max_pages==c.tribe_paged?a(".tribe-events-nav-next").hide():a(".tribe-events-nav-next").show():c.max_pages==c.tribe_paged?a(".tribe-events-nav-previous").hide():a(".tribe-events-nav-previous").show(),0===k.ajax_response.total_count&&a(".tribe-events-sub-nav").remove(),a.each(c.markers,function(b,a){d.map_add_marker(a.lat,a.lng,a.title,a.address,a.link)}),f.pushstate&&
(b.page_title=a("#tribe-events-header").data("title"),m.title=b.page_title,b.do_string&&history.pushState({tribe_paged:b.paged,tribe_params:b.params},b.page_title,k.cur_url+"?"+b.params),b.pushstate&&history.pushState({tribe_paged:b.paged,tribe_params:b.params},b.page_title,k.cur_url)),a(h).trigger("tribe_ev_ajaxSuccess").trigger("tribe_ev_mapView_AjaxSuccess"),0<c.markers.length&&t())})}function w(c){"change_view"!=tribe_events_bar_action&&(c.preventDefault(),b.ajax_running||(b.paged=1,b.view="map",
b.popping=!1,f.pushstate?d.pre_ajax(function(){g(null)}):d.pre_ajax(function(){a(h).trigger("tribe_ev_reloadOldBrowser")})))}function s(){if(c.markers){for(i in c.markers)c.markers[i].setMap(null);c.markers.length=0;c.bounds=new google.maps.LatLngBounds}}function t(){c.map.fitBounds(c.bounds);13<c.map.getZoom()&&c.map.setZoom(13)}function l(){a("#tribe-events-footer, #tribe-events-header").find(".tribe-events-ajax-loading").show()}function u(){a("#tribe-events-footer, #tribe-events-header").find(".tribe-events-ajax-loading").hide()}
n();var e={zoom:5,center:new google.maps.LatLng(GeoLoc.center.max_lat,GeoLoc.center.max_lng),mapTypeId:google.maps.MapTypeId.ROADMAP};m.getElementById("tribe-geo-map")&&(c.map=new google.maps.Map(m.getElementById("tribe-geo-map"),e),c.bounds=new google.maps.LatLngBounds,e=new google.maps.LatLng(GeoLoc.center.min_lat,GeoLoc.center.min_lng),c.bounds.extend(e),e=new google.maps.LatLng(GeoLoc.center.max_lat,GeoLoc.center.max_lng),c.bounds.extend(e));a().placeholder&&a("#tribe-geo-location").placeholder();
if(f.map_view()){if(e=d.get_url_param("tribe_paged"))b.paged=e;a("body").addClass("events-list");d.tooltips()}f.map_view()&&k.params?(e=k.params,0<=d.in_params(e,"tribe_geosearch")||(e+="&action=tribe_geosearch"),0<=d.in_params(e,"tribe_paged")||(e+="&tribe_paged=1"),b.params=e,b.do_string=!1,b.pushstate=!1,b.popping=!0,d.pre_ajax(function(){g(null)})):f.map_view()&&(b.do_string=!1,b.pushstate=!1,b.popping=!1,b.initial_load=!0,d.pre_ajax(function(){g(null)}));f.pushstate&&f.map_view()&&(history.replaceState({tribe_paged:b.paged,
tribe_params:b.params},"",location.href),a(p).on("popstate",function(a){if(a=a.originalEvent.state)b.do_string=!1,b.pushstate=!1,b.popping=!0,b.params=a.tribe_params,b.paged=a.tribe_paged,d.pre_ajax(function(){g(null)}),d.set_form(b.params)}));f.map_view()&&(a("#tribe-geo-options").on("click","a",function(b){l();b.preventDefault();a("#tribe-geo-options a").removeClass("tribe-option-loaded");a(this).addClass("tribe-option-loaded");a("#tribe-bar-geoloc").val(a(this).text());a("#tribe-bar-geoloc-lat").val(c.geocodes[a(this).attr("data-index")].geometry.location.lat());
a("#tribe-bar-geoloc-lng").val(c.geocodes[a(this).attr("data-index")].geometry.location.lng());f.pushstate?d.pre_ajax(function(){g(null);a("#tribe-geo-options").hide()}):d.pre_ajax(function(){a(h).trigger("tribe_ev_reloadOldBrowser")})}),d.snap("#tribe-events-content-wrapper","#tribe-events-content-wrapper","#tribe-events-footer .tribe-events-nav-previous a, #tribe-events-footer .tribe-events-nav-next a"));a(h).on("tribe_ev_reloadOldBrowser",function(){r();p.location=k.cur_url+"?"+b.params});if(f.map_view()){var v;
a("#tribe-geo-map-wrapper").resize(function(){v=c.map.getCenter();google.maps.event.trigger(c.map,"resize");c.map.setCenter(v)});a("#tribe-events").on("click","li.tribe-events-nav-next a",function(c){c.preventDefault();b.ajax_running||("past"===b.view?1===b.paged?b.view="map":b.paged--:b.paged++,b.popping=!1,f.pushstate?d.pre_ajax(function(){g(null)}):d.pre_ajax(function(){a(h).trigger("tribe_ev_reloadOldBrowser")}))}).on("click","li.tribe-events-nav-previous a",function(c){c.preventDefault();b.ajax_running||
("map"===b.view?1===b.paged?b.view="past":b.paged--:b.paged++,b.popping=!1,f.pushstate?d.pre_ajax(function(){g(null)}):d.pre_ajax(function(){a(h).trigger("tribe_ev_reloadOldBrowser")}))})}if(GeoLoc.map_view&&a("form#tribe-bar-form").length)a("#tribe-events-bar").on("changeDate","#tribe-bar-date",function(a){w(a)});if(GeoLoc.map_view)a(h).on("tribe_ev_runAjax",function(){g(null)});f.map_view()&&(a("form#tribe-bar-form").on("submit",function(){if("change_view"!=tribe_events_bar_action){b.paged=1;l();
a(".tribe-events-sub-nav").remove();var e=a("#tribe-bar-geoloc").val();return""!==e?(s(),a("#tribe-geo-results").empty(),a("#tribe-geo-options").hide(),a("#tribe-geo-options #tribe-geo-links").empty(),d.process_geocoding(e,function(b){c.geocodes=b;u();var e=b[0].geometry.location.lat();b=b[0].geometry.location.lng();e&&a("#tribe-bar-geoloc-lat").val(e);b&&a("#tribe-bar-geoloc-lng").val(b);1<c.geocodes.length?(d.print_geo_options(),n(),t()):f.pushstate?(n(),g(c.geocodes[0])):a(h).trigger("tribe_ev_reloadOldBrowser")}),
!1):""===e?(a("#tribe-bar-geoloc-lat").val(""),a("#tribe-bar-geoloc-lng").val(""),a("#tribe-geo-options").hide(),f.pushstate?(n(),g(null)):a(h).trigger("tribe_ev_reloadOldBrowser"),u(),!1):!0}}),b.view&&q&&debug.timeEnd("Tribe JS Init Timer"));q&&debug.info("TEC Debug: tribe-events-ajax-maps.js successfully loaded")})})(window,document,jQuery,tribe_ev.data,tribe_ev.events,tribe_ev.fn,tribe_ev.geoloc,tribe_ev.state,tribe_ev.tests,tribe_debug);
