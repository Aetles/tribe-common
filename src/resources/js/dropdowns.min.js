var tribe_dropdowns=tribe_dropdowns||{};!function(e,t){"use strict";t.selector={dropdown:".tribe-dropdown"},e.fn.tribe_dropdowns=function(){return t.dropdown(this),this},t.freefrom_create_search_choice=function(e,t){var a=this.opts,r=a.$select;if(e.match(a.regexToken)&&(!r.is("[data-int]")||r.is("[data-int]")&&e.match(/\d+/))){var i={id:e,text:e,"new":!0};return r.is("[data-create-choice-template]")&&(i.text=_.template(r.data("createChoiceTemplate"))({term:e})),i}},t.allow_html_markup=function(e){return e},t.search_id=function(e){var t=void 0;return"undefined"!=typeof e.id?t=e.id:"undefined"!=typeof e.ID?t=e.ID:"undefined"!=typeof e.value&&(t=e.value),void 0===e?void 0:t},t.matcher=function(e,a){var r=this.element,i=r.data("dropdown"),o=0==a.toUpperCase().indexOf(e.toUpperCase());if(!o&&"undefined"!=typeof i.tags){var n=_.where(i.tags,{text:a});if(i.tags.length>0&&_.isObject(n)){var s=t.search_id(n[0]);o=0==s.toUpperCase().indexOf(e.toUpperCase())}}return o},t.init_selection=function(t,a){var r=t,i=r.data("dropdown"),o=[],n=r.is("[data-multiple]");e(t.val().split(i.regexSplit)).each(function(){var e={id:this,text:this};if(i.data.length>0&&_.isObject(i.data[0])){var t=_.where(i.data,{text:this.valueOf()});t.length>0?e=t[0]:(t=_.where(i.data,{id:parseInt(this.valueOf(),10)}),t.length>0&&(e=t[0]))}n?o.push(e):a(e)}),n&&a(o)},t.element=function(a){var r,i=e(this),o={},n=["depends","condition","conditionNot","condition-not","conditionNotEmpty","condition-not-empty","conditionEmpty","condition-empty","conditionIsNumeric","condition-is-numeric","conditionIsNotNumeric","condition-is-not-numeric","conditionChecked","condition-is-checked"];if(o.$select=i,o.dropdownAutoWidth=!0,o.containerCss={},i.is(":visible")&&(o.containerCss.display="inline-block"),o.dropdownCss={width:"auto"},o.matcher=t.matcher,i.is("select")||(o.id=t.search_id),o.allowClear=!0,i.is("[data-prevent-clear]")&&(o.allowClear=!1),i.is("[data-options]")&&(o.data=i.data("options"),i.is("select")||(o.initSelection=t.init_selection)),i.is("[data-allow-html]")&&(o.escapeMarkup=t.allow_html_markup),i.is("[data-hide-search]")&&(o.minimumResultsForSearch=1/0),i.is("[data-freeform]")&&(o.createSearchChoice=t.freefrom_create_search_choice),"tribe-ea-field-origin"===i.attr("id")&&(o.formatResult=o.upsellFormatter,o.formatSelection=o.upsellFormatter,o.escapeMarkup=t.allow_html_markup),i.is("[multiple]")&&(o.multiple=!0,_.isArray(i.data("separator"))?o.tokenSeparators=i.data("separator"):o.tokenSeparators=[i.data("separator")],o.separator=i.data("separator"),o.regexSeparatorElements=["^("],o.regexSplitElements=["(?:"],e.each(o.tokenSeparators,function(e,t){o.regexSeparatorElements.push("[^"+t+"]+"),o.regexSplitElements.push("["+t+"]")}),o.regexSeparatorElements.push(")$"),o.regexSplitElements.push(")"),o.regexSeparatorString=o.regexSeparatorElements.join(""),o.regexSplitString=o.regexSplitElements.join(""),o.regexToken=new RegExp(o.regexSeparatorString,"ig"),o.regexSplit=new RegExp(o.regexSplitString,"ig")),i.is("[data-tags]")&&(o.tags=i.data("tags"),o.initSelection=t.init_selection,o.createSearchChoice=function(e,t){return e.match(o.regexToken)?{id:e,text:e}:void 0},0===o.tags.length&&(o.formatNoMatches=function(){return i.attr("placeholder")})),i.is("[data-source]")){var s=i.data("source");o.data={results:[]},o.escapeMarkup=t.allow_html_markup,o.ajax={dataType:"json",type:"POST",url:window.ajaxurl,results:function(e){return e.data}},o.ajax.data=function(e,t){return{action:"tribe_aggregator_dropdown_"+s}}}i.data("dropdown",o),r=i.select2(o).select2("container"),n.length>0&&n.map(function(e){var t="data-"+e,a=i.attr(t);a&&this.attr(t,a)},r)},t.action_change=function(t){var a=e(this),r=e(this).data("value");a.is("[multiple]")&&a.is("[data-source]")&&(t.added?_.isArray(r)?r.push(t.added):r=[t.added]:r=_.isArray(r)?_.without(r,t.removed):[],a.data("value",r).attr("data-value",JSON.stringify(r)))},t.action_select2_removed=function(t){var a=e(this);a.is("[data-sticky-search]")&&a.is("[data-last-search]")&&a.removeAttr("data-last-search").removeData("lastSeach")},t.action_select2_close=function(t){var a=e(this),r=e(".select2-input.select2-focused");a.is("[data-sticky-search]")&&r.off("keyup-change.tribe")},t.action_select2_open=function(t){var a=e(this),r=e(".select2-input:visible");a.is("[data-search-placeholder]")&&r.attr("placeholder",a.data("searchPlaceholder")),a.is("[data-sticky-search]")&&(r.on("keyup-change.tribe",function(){a.data("lastSearch",e(this).val()).attr("data-last-search",e(this).val())}),a.is("[data-last-search]")&&r.val(a.data("lastSearch")).trigger("keyup-change"))},t.dropdown=function(e){var a=e.not(".select2-offscreen, .select2-container");return a.each(t.element).on("select2-open",t.action_select2_open).on("select2-close",t.action_select2_close).on("select2-removed",t.action_select2_removed).on("change",t.action_change),a},e(function(){e(t.selector.dropdown).tribe_dropdowns()})}(jQuery,tribe_dropdowns);